{% extends "index.html" %}

{% block maincontent %}
{% load dictionary_helpers %}
<div id="search-results" class="row">
  {% if vid.id.kind == "youtube#video" %}
  <div class="row"> 
    <div class="panel-group col-md-12" id="accordion{{forloop.counter0}}">
      <div class="panel panel-default">
        <div class="panel-heading">
          <h4 class="panel-title">
            <a class="accordion-toggle" data-toggle="collapse" data-parent="#accordion{{forloop.counter0}}" href="#collapse{{forloop.counter0}}">
              Video Information
            </a>
          </h4>
        </div>
        <div id="collapse{{forloop.counter0}}" class="panel-collapse collapse">
          <div class="panel-body">
            {% with metadata=data.metadata|get_metadata:vid.id.videoId %}
            <form id="form-container">
              {% csrf_token %} 
              <input
                type="hidden"
                value="{{vid.id.videoId}}"
                name="vid"
              />
              {% if metadata == None %}
              <input 
                type="hidden"
                value="{{vid.snippet.description}}"
                name="vdesc"
              />
              <input
                type="hidden"
                value="{{vid.snippet.title}}"
                name="vtitle"
              />
              <input
                type="hidden"
                value="{{vid.snippet.thumbnails.default.url}}"
                name="dthumb"
              />
              {% endif %}
              <div class="row">
                <div class="input-group col-md-6"> 
                  <span class="input-group-addon">Song</span> 
                  <input
                    type="text"
                    class="form-control"
                    placeholder="Enter Song Title"
                    name="song_title"
                    value=""
                  /> 
                </div> 
                <div class="input-group col-md-6"> 
                  <span class="input-group-addon">Composer</span> 
                  <input
                    type="text"
                    class="form-control"
                    placeholder="Enter Composer Name"
                    name="composer_name"
                    value=""
                  /> 
                </div> 
                <button type="submit" class="btn btn-primary add-song">
                  Submit
                </button>
              </div>
              <div class="row">
                <div class="input-group col-md-6"> 
                  <span class="input-group-addon">Group</span> 
                  <input 
                    type="text"
                    class="form-control"
                    placeholder="Enter Group Name"
                    name="group_name"
                    value=""
                  />
                </div>
                <button type="submit" class="btn btn-primary">
                  Submit
                </button>
                <!--<div class="input-group col-md-2">-->
                  <!--<span class="input-group-addon">Open Source</span>-->
                  <!--<span class="input-group-addon">-->
                    <!--<input type="checkbox" name="is_open_source">-->
                  <!--</span>-->
                <!--</div>-->
                <!--<div class="input-group col-md-2">-->
                  <!--<span class="input-group-addon">Drill</span>-->
                  <!--<span class="input-group-addon">-->
                    <!--<input type="checkbox" name="is_drill">-->
                  <!--</span>-->
                <!--</div>-->
                <!--<div class="input-group col-md-2">-->
                  <!--<span class="input-group-addon">Copyrighted</span>-->
                  <!--<span class="input-group-addon">-->
                    <!--<input type="checkbox" name="is_copyrighted">-->
                  <!--</span>-->
                <!--</div>-->
              </div>
            </form>
            {% endwith %}
          </div> 
        </div>
      </div>
    </div>
  </div><!-- end search-result -->
  {% endif %}
</div>
{% block footer %}
<ul class="pager">
  {% if data.videos.prevPageToken %}
  <li class="previous"><a href="/?query={{data.query}}&pageToken={{data.videos.prevPageToken}}">&larr; Older</a></li>
  {% else %}
  <li class="previous disabled"><a>&larr; Older</a></li>
  {% endif %}
  <li class="next"><a href="/?query={{data.query}}&pageToken={{data.videos.nextPageToken}}">Newer &rarr;</a></li>
</ul>
{% endblock footer %}
{% endblock maincontent %}

{% block js %}
<script src="/static/js/build/SearchResult.js"></script>
<script src="/static/js/build/SearchResultContainer.js"></script>
<script>
  React.renderComponent(
    SearchResultContainer({data:{{data|safe}}}),
    document.getElementById('search-results')
  );
  var csrftoken = $.cookie('csrftoken');
  function csrfSafeMethod(method) {
    // these HTTP methods do not require CSRF protection
    return (/^(GET|HEAD|OPTIONS|TRACE)$/.test(method));
  }
  $.ajaxSetup({
    crossDomain: false,
    beforeSend: function(xhr, settings) {
      if (!csrfSafeMethod(settings.type)) {
        xhr.setRequestHeader("X-CSRFToken", csrftoken);
      }
    }
  });
  $("#form-container").on('submit', function(e) {
    var values = {};
    var postURL = "";
    var $button = $("input[type=submit][clicked=true]");
    if ($button.hasClass("add-song")) {
      postURL = "add-song-data/";
    } else if ($button.hasClass("add-group")) {
      postURL = "add-group-data/";
    }
    console.log(postURL);
    console.log($button);
    $.each($(this).serializeArray(), function(i, field) {
      values[field.name] = field.value;
    });
    console.log(values);
    console.log(e);
    /*$.post(
      postURL,
      values,
      function() {
        console.log("success");
      }
    );*/
    return false;
  });
</script>
{% endblock js %}
