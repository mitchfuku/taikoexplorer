{% extends "index.html" %}

{% block maincontent %}
{% load dictionary_helpers %}
{% if request.GET.type == "yt" and not request.GET.pageToken and not request.GET.overrideheader == "true" %}
<div class="row">
  <div class="search-result col-md-12">
    <h5>
      No tagged videos were found for the search term "{{request.GET.query}}".  Here are some related videos found on Youtube:
    </h5>
  </div>
</div>
{% elif request.GET.type == "db" and not request.GET.pageToken and not request.GET.overrideheader == "true" %}
<div class="row">
  <div class="search-result col-md-12">
    <h5>
      Here are tagged videos found for the search term "{{request.GET.query}}":
    </h5>
  </div>
</div>
{% endif %}
<div id="react-search-results" class="row"></div>
{% if request.GET.type == "db"%}
<div class="row">
  <div class="search-result col-md-12">
    <h5>
      Haven't found the video you're looking for? Search Youtube by clicking <a href="/?query={{request.GET.query}}&type=yt&overrideheader=true">here</a>.
    </h5>
  </div>
</div>
{% endif %}
{% block footer %}
<div id="react-pager"></div>
{% endblock footer %}
{% endblock maincontent %}

{% block js %}
<script src="/static/js/build/Shield.js"></script>
<script src="/static/js/build/ReactTypeaheadInput.js"></script>
<script src="/static/js/build/ReactInput.js"></script>
<script src="/static/js/build/AddVideoDataForm.js"></script>
<script src="/static/js/build/SearchResultFormWrapper.js"></script>
<script src="/static/js/build/SearchResult.js"></script>
<script src="/static/js/build/SearchResultContainer.js"></script>
<script src="/static/js/build/SearchResultsPager.js"></script>
<script>
  var data = {{data|safe}};
  var shield = React.renderComponent(
    Shield({}),
    document.getElementById('shield-container')
  );
  React.renderComponent(
    SearchResultContainer(
      {
        data:data,
        csrftoken:"{{csrf_token}}", 
        shield: shield
      }
    ),
    document.getElementById('react-search-results')
  );
  console.log(data.videos);
  React.renderComponent(
    SearchResultsPager(
      {
        nextpagetoken:data.videos.nextPageToken,
        prevpagetoken:data.videos.prevPageToken,
        query:data.query,
        type:"{{request.GET.type}}"
      }
    ),
    document.getElementById('react-pager')
  );

  var csrftoken = $.cookie('csrftoken');
  function csrfSafeMethod(method) {
    // these HTTP methods do not require CSRF protection
    return (/^(GET|HEAD|OPTIONS|TRACE)$/.test(method));
  }
  $.ajaxSetup({
    crossDomain: false,
    beforeSend: function(xhr, settings) {
      if (!csrfSafeMethod(settings.type)) {
        xhr.setRequestHeader("X-CSRFToken", csrftoken);
      }
    }
  });
</script>
{% endblock js %}
