{% extends "index.html" %}

{% block maincontent %}
{% load dictionary_helpers %}
<div id="react-search-results" class="row"></div>
<div id="react-pager"></div>
{% block footer %}
{% endblock footer %}
{% endblock maincontent %}

{% block js %}
<script src="/static/js/build/SearchResultForm.js"></script>
<script src="/static/js/build/SearchResult.js"></script>
<script src="/static/js/build/SearchResultContainer.js"></script>
<script src="/static/js/build/SearchResultsPager.js"></script>
<script>
  var data = {{data|safe}};
  React.renderComponent(
    SearchResultContainer({data:data, csrftoken:"{{csrf_token}}"}),
    document.getElementById('react-search-results')
  );
  React.renderComponent(
    SearchResultsPager(
      {
        nextpagetoken:data.videos.nextPageToken,
        prevpagetoken:data.videos.prevPageToken,
        query:data.query
      }
    ),
    document.getElementById('react-pager')
  );

  var csrftoken = $.cookie('csrftoken');
  function csrfSafeMethod(method) {
    // these HTTP methods do not require CSRF protection
    return (/^(GET|HEAD|OPTIONS|TRACE)$/.test(method));
  }
  $.ajaxSetup({
    crossDomain: false,
    beforeSend: function(xhr, settings) {
      if (!csrfSafeMethod(settings.type)) {
        xhr.setRequestHeader("X-CSRFToken", csrftoken);
      }
    }
  });
  $("#form-container").on('submit', function(e) {
    var values = {};
    var postURL = "";
    var $button = $("input[type=submit][clicked=true]");
    if ($button.hasClass("add-song")) {
      postURL = "add-song-data/";
    } else if ($button.hasClass("add-group")) {
      postURL = "add-group-data/";
    }
    console.log(postURL);
    console.log($button);
    $.each($(this).serializeArray(), function(i, field) {
      values[field.name] = field.value;
    });
    console.log(values);
    console.log(e);
    /*$.post(
      postURL,
      values,
      function() {
        console.log("success");
      }
    );*/
    return false;
  });
</script>
{% endblock js %}
