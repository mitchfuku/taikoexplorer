{% extends "index.html" %}

{% block maincontent %}
<div>
  {{data.tags}}
</div>
<div id="search-results" class="row">
  {% for vid in data.videos.items %}
  <div class="row search-result"> 
    <div class="col-md-4 video-thumb"> 
      <a href="https://www.youtube.com/watch?v={{vid.id.videoId}}"> 
        <img src="{{vid.snippet.thumbnails.medium.url}}" /> 
      </a> 
    </div> 
    <div class="col-md-8 video-details"> 
      <h4 class="title"> 
        <a href="https://www.youtube.com/watch?v={{vid.id.videoId}}">
          {{vid.snippet.title}}
        </a> 
      </h4> 
      <p class="info"> 
        by <a href="https://www.youtube.com/user/{{vid.snippet.channelTitle}}" target="_blank">{{vid.snippet.channelTitle}}</a> 
      </p> 
      <p class="desc">{{vid.snippet.description}}</p>
      <div class="row"> 
        <div class="panel-group col-md-12" id="accordion">
          <div class="panel panel-default">
            <div class="panel-heading">
              <h4 class="panel-title">
                <a class="accordion-toggle" data-toggle="collapse" data-parent="#accordion" href="#collapseOne">
                  Video Information
                </a>
              </h4>
            </div>
            <div id="collapseOne" class="panel-collapse collapse in">
              <div class="panel-body">
                <form method="post">
                  {% csrf_token %} 
                  <input type="hidden" value={{vid.id.videoId}} name="vid" />
                  <div class="row">
                    <div class="input-group col-md-6"> 
                      <span class="input-group-addon">Group</span> 
                      <input type="text" class="form-control" placeholder="Enter Group Name" name="group_name"> 
                    </div>
                    <div class="input-group col-md-6"> 
                      <span class="input-group-addon">Song</span> 
                      <input type="text" class="form-control" placeholder="Enter Song Title" name="song_title"> 
                    </div> 
                  </div>
                  <div class="row">
                    <div class="input-group col-md-6"> 
                      <span class="input-group-addon">Composer</span> 
                      <input type="text" class="form-control" placeholder="Enter Composer" name="composer"> 
                    </div> 
                    <div class="input-group col-md-2">
                      <span class="input-group-addon">Open Source</span>
                      <span class="input-group-addon">
                        <input type="checkbox" name="is_open_source">
                      </span>
                    </div>
                    <div class="input-group col-md-2">
                      <span class="input-group-addon">Drill</span>
                      <span class="input-group-addon">
                        <input type="checkbox" name="is_drill">
                      </span>
                    </div>
                    <div class="input-group col-md-2">
                      <span class="input-group-addon">Copyrighted</span>
                      <span class="input-group-addon">
                        <input type="checkbox" name="is_copyrighted">
                      </span>
                    </div>
                  </div>
                  <div class="row">
                    <div class="col-md-2">
                      <button type="submit" class="btn btn-primary">
                        Submit
                      </button>
                    </div>
                  </div>
                </form>
              </div> 
            </div>
          </div>
        </div>
      </div>
    </div> 
  </div>
  {% endfor %}
</div>
{% endblock maincontent %}

{% block js %}
<script>
  var csrftoken = $.cookie('csrftoken');
  function csrfSafeMethod(method) {
    // these HTTP methods do not require CSRF protection
    return (/^(GET|HEAD|OPTIONS|TRACE)$/.test(method));
  }
  $.ajaxSetup({
    crossDomain: false,
    beforeSend: function(xhr, settings) {
      if (!csrfSafeMethod(settings.type)) {
        xhr.setRequestHeader("X-CSRFToken", csrftoken);
      }
    }
  });
  $("#search-results").delegate('form', 'submit', function(e) {
    var values = {};
    $.each($(this).serializeArray(), function(i, field) {
      values[field.name] = field.value;
    });
    $.post(
      "video-data/",
      values,
      function() {
        console.log("success");
      }
    );
    return false;
  });
</script>
{% endblock js %}
