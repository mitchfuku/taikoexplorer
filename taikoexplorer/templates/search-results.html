{% extends "index.html" %}

{% block maincontent %}
{% load dictionary_helpers %}
<div id="search-results" class="row">
  {% for vid in data.videos.items %}
    <div class="row search-result"> 
      <div class="col-md-4 video-thumb"> 
        {% if vid.id.kind == "youtube#video" %}
        <a href="https://www.youtube.com/watch?v={{vid.id.videoId}}"> 
          <img src="{{vid.snippet.thumbnails.medium.url}}" /> 
        </a> 
      </div> 
      <div class="col-md-8 video-details"> 
        <h4 class="title"> 
          <a href="https://www.youtube.com/watch?v={{vid.id.videoId}}">
        {% elif vid.id.kind == "youtube#channel" %}
        <a href="https://www.youtube.com/user/{{vid.snippet.channelTitle}}"> 
          <img src="{{vid.snippet.thumbnails.default.url}}" /> 
        </a> 
      </div> 
      <div class="col-md-8 video-details"> 
        <h4 class="title"> 
          <a href="https://www.youtube.com/user/{{vid.snippet.channelTitle}}">
        {% endif %}
            {{vid.snippet.title}}
          </a> 
        </h4> 
        <p class="info"> 
          by <a href="https://www.youtube.com/user/{{vid.snippet.channelTitle}}" target="_blank">{{vid.snippet.channelTitle}}</a> 
        </p> 
        <p class="desc">{{vid.snippet.description}}</p>
        {% if vid.id.kind == "youtube#video" %}
        <div class="row"> 
          <div class="panel-group col-md-12" id="accordion{{forloop.counter0}}">
            <div class="panel panel-default">
              <div class="panel-heading">
                <h4 class="panel-title">
                  <a class="accordion-toggle" data-toggle="collapse" data-parent="#accordion{{forloop.counter0}}" href="#collapse{{forloop.counter0}}">
                    Video Information
                  </a>
                </h4>
              </div>
              <div id="collapse{{forloop.counter0}}" class="panel-collapse collapse">
                <div class="panel-body">
                  <form method="post">
                    {% csrf_token %} 
                    <input
                      type="hidden"
                      value="{{vid.id.videoId}}"
                      name="vid"
                    />
                    <input 
                      type="hidden"
                      value="{{vid.snippet.description}}"
                      name="vdesc"
                    />
                    <input
                      type="hidden"
                      value="{{vid.snippet.title}}"
                      name="vtitle"
                    />
                    <input
                      type="hidden"
                      value="{{vid.snippet.thumbnails.default.url}}"
                      name="dthumb"
                    />
                    <div class="row">
                      <div class="input-group col-md-6"> 
                        <span class="input-group-addon">Group</span> 
                        <input 
                          type="text"
                          class="form-control"
                          placeholder="Enter Group Name"
                          name="group_name"
                          value="{{data.tags|get_group:vid.id.videoId}}"
                        >
                      </div>
                      <div class="input-group col-md-6"> 
                        <span class="input-group-addon">Song</span> 
                        <input
                          type="text"
                          class="form-control"
                          placeholder="Enter Song Title"
                          name="song_title"
                          value="{{data.tags|get_song:vid.id.videoId}}"
                        > 
                      </div> 
                    </div>
                    <div class="row">
                      <div class="input-group col-md-6"> 
                        <span class="input-group-addon">Composer</span> 
                        <input
                          type="text"
                          class="form-control"
                          placeholder="Enter Composer"
                          name="composer_name"
                          value="{{data.tags|get_composer:vid.id.videoId}}"
                        > 
                      </div> 
                      <div class="input-group col-md-2">
                        <span class="input-group-addon">Open Source</span>
                        <span class="input-group-addon">
                          <input type="checkbox" name="is_open_source">
                        </span>
                      </div>
                      <div class="input-group col-md-2">
                        <span class="input-group-addon">Drill</span>
                        <span class="input-group-addon">
                          <input type="checkbox" name="is_drill">
                        </span>
                      </div>
                      <div class="input-group col-md-2">
                        <span class="input-group-addon">Copyrighted</span>
                        <span class="input-group-addon">
                          <input type="checkbox" name="is_copyrighted">
                        </span>
                      </div>
                    </div>
                    <div class="row">
                      <div class="col-md-2">
                        <button type="submit" class="btn btn-primary">
                          Submit
                        </button>
                      </div>
                    </div>
                  </form>
                </div> 
              </div>
            </div>
          </div>
        </div><!-- end search-result -->
      {% endif %}
    </div> 
  </div>
  {% endfor %}
</div>
{% block footer %}
<ul class="pager">
  {% if data.videos.prevPageToken %}
  <li class="previous"><a href="/?query={{data.query}}&pageToken={{data.videos.prevPageToken}}">&larr; Older</a></li>
  {% else %}
  <li class="previous disabled"><a>&larr; Older</a></li>
  {% endif %}
  <li class="next"><a href="/?query={{data.query}}&pageToken={{data.videos.nextPageToken}}">Newer &rarr;</a></li>
</ul>
{% endblock footer %}
{% endblock maincontent %}

{% block js %}
<script>
  var csrftoken = $.cookie('csrftoken');
  function csrfSafeMethod(method) {
    // these HTTP methods do not require CSRF protection
    return (/^(GET|HEAD|OPTIONS|TRACE)$/.test(method));
  }
  $.ajaxSetup({
    crossDomain: false,
    beforeSend: function(xhr, settings) {
      if (!csrfSafeMethod(settings.type)) {
        xhr.setRequestHeader("X-CSRFToken", csrftoken);
      }
    }
  });
  $("#search-results").delegate('form', 'submit', function(e) {
    var values = {};
    $.each($(this).serializeArray(), function(i, field) {
      values[field.name] = field.value;
    });
    $.post(
      "video-data/",
      values,
      function() {
        console.log("success");
      }
    );
    return false;
  });
</script>
{% endblock js %}
